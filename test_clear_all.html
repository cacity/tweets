<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试删除所有订阅源</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>测试删除所有订阅源功能</h1>
        
        <div class="mt-4">
            <button id="testBtn" class="btn btn-danger" onclick="testClearAll()">
                <i class="bi bi-trash me-1"></i>测试删除所有订阅源
            </button>
        </div>
        
        <div id="result" class="mt-4"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function testClearAll() {
            const button = document.getElementById('testBtn');
            const result = document.getElementById('result');
            
            button.disabled = true;
            button.innerHTML = '<i class="bi bi-trash spin me-1"></i>测试中...';
            
            result.innerHTML = '<div class="alert alert-info">正在测试API...</div>';
            
            fetch('/api/clear_all_feeds', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                console.log('响应状态:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('响应数据:', data);
                
                if (data.success) {
                    result.innerHTML = `
                        <div class="alert alert-success">
                            <i class="bi bi-check-circle me-2"></i>
                            <strong>成功！</strong> ${data.message}
                        </div>
                    `;
                } else {
                    result.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="bi bi-x-circle me-2"></i>
                            <strong>失败！</strong> ${data.message}
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('错误:', error);
                result.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <strong>错误！</strong> ${error.message}
                    </div>
                `;
            })
            .finally(() => {
                button.disabled = false;
                button.innerHTML = '<i class="bi bi-trash me-1"></i>测试删除所有订阅源';
            });
        }
        
        // CSS动画
        const style = document.createElement('style');
        style.textContent = `
            .spin {
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>