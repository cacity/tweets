{% extends "base.html" %}

{% block title %}热门榜单 - RSS订阅管理器{% endblock %}

{% block extra_head %}
<style>
.trending-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 2rem 0;
    margin-bottom: 2rem;
}

.trending-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.trending-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
}

.ranking-item {
    background: white;
    border: 1px solid #e1e8ed;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.ranking-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    border-color: #1da1f2;
}

.rank-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: linear-gradient(45deg, #ff6b6b, #ee5a24);
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 0.9rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.rank-badge.top-3 {
    background: linear-gradient(45deg, #ffd700, #ffb347);
}

.item-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: #0f1419;
    text-decoration: none;
    display: block;
    margin-bottom: 0.8rem;
    line-height: 1.4;
}

.item-title:hover {
    color: #1da1f2;
    text-decoration: none;
}

.item-summary {
    color: #536471;
    line-height: 1.6;
    margin-bottom: 1rem;
    font-size: 0.95rem;
}

.item-meta {
    display: flex;
    align-items: center;
    gap: 1rem;
    font-size: 0.85rem;
    color: #657786;
    flex-wrap: wrap;
}

.score-badge {
    background: #e1f5fe;
    color: #0277bd;
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-weight: 500;
    font-size: 0.8rem;
}

.category-nav {
    margin-bottom: 2rem;
}

.category-btn {
    display: inline-block;
    padding: 0.5rem 1rem;
    margin: 0.25rem;
    background: #f7f9fa;
    color: #14171a;
    text-decoration: none;
    border-radius: 20px;
    transition: all 0.2s ease;
    font-size: 0.9rem;
}

.category-btn:hover {
    background: #1da1f2;
    color: white;
    text-decoration: none;
}

.category-btn.active {
    background: #1da1f2;
    color: white;
}

.generate-section {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    text-align: center;
}

.generate-btn {
    background: linear-gradient(45deg, #1da1f2, #0d8bf2);
    color: white;
    border: none;
    padding: 0.75rem 2rem;
    border-radius: 25px;
    font-weight: 600;
    transition: all 0.3s ease;
    cursor: pointer;
}

.generate-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 15px rgba(29, 161, 242, 0.3);
}

.generate-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.empty-state {
    text-align: center;
    padding: 3rem;
    color: #657786;
}

.empty-state i {
    font-size: 4rem;
    margin-bottom: 1rem;
    color: #aab8c2;
}

.status-info {
    background: #e8f5e8;
    border: 1px solid #4caf50;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
    color: #2e7d32;
}

@media (max-width: 768px) {
    .trending-title {
        font-size: 2rem;
    }
    
    .ranking-item {
        padding: 1rem;
    }
    
    .item-meta {
        font-size: 0.8rem;
    }
}
</style>
{% endblock %}

{% block content %}
<!-- 页面头部 -->
<div class="trending-header">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h1 class="trending-title">🔥 热门榜单</h1>
                <p class="trending-subtitle">基于智能算法的RSS内容推荐</p>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <!-- 榜单生成控制 -->
    <div class="generate-section">
        <h5 class="mb-3">📊 榜单管理</h5>
        
        {% if result['meta']['generated_at'] %}
        <div class="status-info">
            <i class="bi bi-check-circle me-2"></i>
            最后更新时间: {{ result['meta']['generated_at'][:19] | replace('T', ' ') }}
            {% if result['meta']['ai_summary_enabled'] %}
            <span class="badge bg-success ms-2">AI增强</span>
            {% endif %}
        </div>
        {% endif %}
        
        <button id="generateBtn" class="generate-btn">
            <i class="bi bi-arrow-clockwise me-2"></i>生成最新榜单
        </button>
        
        <div id="generateStatus" class="mt-3" style="display: none;">
            <div class="spinner-border spinner-border-sm me-2" role="status"></div>
            <span>正在生成榜单，请稍候...</span>
        </div>
    </div>

    <!-- 分类导航 -->
    {% if result['categories'] %}
    <div class="category-nav">
        <h6 class="mb-3">📂 分类榜单</h6>
        <a href="{{ url_for('trending') }}" class="category-btn active">
            <i class="bi bi-house me-1"></i>综合榜单
        </a>
        {% for category, data in result['categories'].items() %}
        <a href="{{ url_for('trending_category', category=category) }}" class="category-btn">
            {% if category == 'ai' %}
                <i class="bi bi-robot me-1"></i>人工智能
            {% elif category == 'tech' %}
                <i class="bi bi-cpu me-1"></i>科技资讯
            {% elif category == 'business' %}
                <i class="bi bi-briefcase me-1"></i>商业资讯
            {% elif category == 'product' %}
                <i class="bi bi-box me-1"></i>产品设计
            {% else %}
                <i class="bi bi-collection me-1"></i>{{ category }}
            {% endif %}
            ({{ data.items|length }})
        </a>
        {% endfor %}
    </div>
    {% endif %}

    <!-- 综合榜单 -->
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4">
                <i class="bi bi-trophy-fill text-warning me-2"></i>
                {{ result['general']['title'] }}
            </h2>
            
            {% if result.general['items'] %}
                {% for item in result.general['items'] %}
                <div class="ranking-item">
                    <div class="rank-badge {% if item.rank <= 3 %}top-3{% endif %}">
                        {{ item.rank }}
                    </div>
                    
                    <a href="{{ item.link }}" target="_blank" class="item-title">
                        {{ item.title }}
                    </a>
                    
                    {% if item.summary %}
                    <div class="item-summary">
                        {{ item.summary }}
                    </div>
                    {% endif %}
                    
                    <div class="item-meta">
                        {% if item.author %}
                        <span>
                            <i class="bi bi-person me-1"></i>{{ item.author }}
                        </span>
                        {% endif %}
                        
                        {% if item.published %}
                        <span>
                            <i class="bi bi-calendar3 me-1"></i>{{ item.published[:10] }}
                        </span>
                        {% endif %}
                        
                        <span class="score-badge">
                            评分: {{ "%.1f" | format(item.score) }}
                        </span>
                        
                        <a href="{{ item.link }}" target="_blank" class="text-primary">
                            <i class="bi bi-box-arrow-up-right me-1"></i>查看原文
                        </a>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <i class="bi bi-inbox"></i>
                    <h4>暂无热门内容</h4>
                    <p>点击上方"生成最新榜单"按钮创建榜单</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const generateBtn = document.getElementById('generateBtn');
    const generateStatus = document.getElementById('generateStatus');
    
    generateBtn.addEventListener('click', function() {
        generateTrendingList();
    });
    
    function generateTrendingList() {
        generateBtn.disabled = true;
        generateStatus.style.display = 'block';
        
        fetch('/api/generate_trending', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                hours: 24,
                count: 20,
                refresh: true,
                use_ai: true
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showToast('榜单生成成功，正在刷新页面...', 'success');
                setTimeout(() => {
                    location.reload();
                }, 2000);
            } else {
                showToast('生成失败: ' + data.message, 'error');
                generateBtn.disabled = false;
                generateStatus.style.display = 'none';
            }
        })
        .catch(error => {
            showToast('网络错误: ' + error.message, 'error');
            generateBtn.disabled = false;
            generateStatus.style.display = 'none';
        });
    }
    
    function showToast(message, type) {
        // 创建toast提示
        const toast = document.createElement('div');
        toast.className = `alert alert-${type === 'success' ? 'success' : 'danger'} position-fixed`;
        toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        toast.innerHTML = `
            <i class="bi bi-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} me-2"></i>
            ${message}
        `;
        
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.remove();
        }, 5000);
    }
});
</script>
{% endblock %}